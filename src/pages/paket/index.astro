---
import PackageCard from "@components/PackageCard.astro";
import MainLayout from "@layouts/MainLayout.astro";

import { getCollection } from "astro:content";

const allPackages = await getCollection("paket");

// Filter packages to avoid showing multiple bromo-midnight variants
const packages = allPackages.filter((entry: any) => {
  const slug = entry.id;
  // Exclude the specific variants, but keep other packages
  return (
    !slug.includes("bromo-midnight-ml") && !slug.includes("bromo-midnight-sby")
  );
});

const cardData = (entry: any) => {
  let slug = entry.id;

  // For the base bromo-midnight package, redirect to the Malang version
  if (slug === "bromo-midnight") {
    slug = "bromo-midnight-ml";
  }

  return {
    image: entry.data.images[0].url,
    title: entry.data.title,
    slug: slug,
    meetingpoint: entry.data.meetingpoint,
    price: entry.data.price,
    features: entry.data.fasilitas.include,
  };
};
---

<MainLayout pageTitle="Paket">
  <h1
    class="sm:text-4xl text-2xl font-bold text-center mb-8 dark:text-[#f3f4f6]"
  >
    Paket Trip
  </h1>
  <div class="mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Packages Grid -->
    <div
      id="packages-grid"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 2xl:max-w-[80%] 2xl:mx-auto"
    >
      {
        packages
          .sort((a: { data: { title: string } }, b: { data: { title: any } }) =>
            a.data.title.localeCompare(b.data.title)
          )
          .map((entry: any) => <PackageCard {...cardData(entry)} />)
      }
    </div>
  </div>
</MainLayout>
